device:
  name: "Hoymiles Inverter"
  manufacturer: "Hoymiles"
  model: "Multiple"

entities:
  # ------------------------------------------------------------
  # [Battery Charge/Discharge Parameters]
  # ------------------------------------------------------------

  - platform: number
    key: battery_max_charge_power
    name: "Battery Max Charge Power (Holding 306, uint16)"
    unit: "% ??"
    minimum: 10
    maximum: 100
    description: "Battery maximum charge power rate"
    read:
      type: holding
      address: 306
      data_type: uint16
    write:
      type: holding
      address: 306
      data_type: uint16

  - platform: number
    key: battery_max_discharge_power
    name: "Battery Max Discharge Power (Holding 307, uint16)"
    unit: "% ??"
    minimum: 10
    maximum: 100
    description: "Battery maximum discharge power rate"
    read:
      type: holding
      address: 307
      data_type: uint16
    write:
      type: holding
      address: 307
      data_type: uint16

  - platform: number
    key: max_soc
    name: "Max SOC (Holding 308, uint16)"
    unit: "%"
    minimum: 10
    maximum: 100
    description: "Battery maximum charge SOC"
    read:
      type: holding
      address: 308
      data_type: uint16
    write:
      type: holding
      address: 308
      data_type: uint16

  - platform: number
    key: min_soc
    name: "Min SOC (Holding 309, uint16)"
    unit: "%"
    minimum: 10
    maximum: 90
    description: "Battery maximum Discharge SOC"
    read:
      type: holding
      address: 309
      data_type: uint16
    write:
      type: holding
      address: 309
      data_type: uint16

  - platform: number
    key: battery_capacity
    name: "Battery Capacity (Holding 4102, uint16)"
    unit: "Ah"
    description: "Battery capacity"
    read:
      type: holding
      address: 4102
      data_type: uint16
      scale: 0.1
#    write:
#      type: holding
#      address: 4102
#      data_type: uint16
#      scale: 0.1

  - platform: sensor
    key: max_charge_current
    name: "Max Charge Current (Holding 4103, uint16)"
    unit: "A"
    description: "Maximum charging current"
    read:
      type: holding
      address: 4103
      data_type: uint16
      scale: 0.1
#    write:
#      type: holding
#      address: 4103
#      data_type: uint16
#      scale: 0.1

  - platform: sensor
    key: max_discharge_current
    name: "Max Discharge Current (Holding 4104, uint16)"
    unit: "A"
    description: "Maximum discharge current"
    read:
      type: holding
      address: 4104
      data_type: uint16
      scale: 0.1
#    write:
#      type: holding
#      address: 4104
#      data_type: uint16
#      scale: 0.1

  # ------------------------------------------------------------
  # [Inverter EMS Parameters]
  # ------------------------------------------------------------

  - platform: select
    key: ems_mode
    name: "EMS Mode (Holding 4300, uint16)"
    options:
      0: "Self-Use"
      1: "Economical Mode"
      2: "Backup Mode"
      3: "Pure Off-Grid Mode"
      4: "Force Charge Mode"
      5: "Force Discharge Mode"
      6: "Peak-shaving Mode"
      7: "TOU Mode"
    read:
      type: holding
      address: 4300
      data_type: uint16
    write:
      type: holding
      address: 4300
      data_type: uint16

  - platform: number
    key: self_used_soc
    name: "Self-Used SOC (Holding 4301, uint16)"
    unit: "%"
    minimum: 10
    maximum: 100
    description: "Reserved SOC in self-use mode"
    read:
      type: holding
      address: 4301
      data_type: uint16
    write:
      type: holding
      address: 4301
      data_type: uint16

  - platform: number
    key: backup_soc
    name: "Back-up SOC (Holding 4302, uint16)"
    unit: "%"
    minimum: 60
    maximum: 100
    description: "Reserved SOC in back-up mode"
    read:
      type: holding
      address: 4302
      data_type: uint16
    write:
      type: holding
      address: 4302
      data_type: uint16

  - platform: number
    key: force_charge_soc
    name: "Force Charge SOC (Holding 4303, uint16)"
    unit: "%"
    minimum: 10
    maximum: 100
    description: "Max SOC in force charge mode"
    read:
      type: holding
      address: 4303
      data_type: uint16
    write:
      type: holding
      address: 4303
      data_type: uint16

  - platform: number
    key: maximum_charge_power
    name: "Maximum Charge Power (Holding 4304, uint16)"
    unit: "%"
    description: "Maximum charge power rate"
    read:
      type: holding
      address: 4304
      data_type: uint16
      scale: 0.1
    write:
      type: holding
      address: 4304
      data_type: uint16
      scale: 0.1

  - platform: number
    key: force_disarge_soc
    name: "Force Discharge SOC (Holding 4305, uint16)"
    unit: "%"
    description: "Max SOC in force discharge mode"
    read:
      type: holding
      address: 4305
      data_type: uint16
    write:
      type: holding
      address: 4305
      data_type: uint16

  - platform: number
    key: maximum_discharge_power
    name: "Maximum Discharge Power (Holding 4306, uint16)"
    unit: "%"
    description: "Maximum discharge power rate"
    read:
      type: holding
      address: 4306
      data_type: uint16
      scale: 0.1
    write:
      type: holding
      address: 4306
      data_type: uint16
      scale: 0.1

  - platform: number
    key: economic_mode_soc
    name: "Economic Mode SOC (Holding 4307, uint16)"
    unit: "%"
    description: "Reserved SOC in economic mode"
    read:
      type: holding
      address: 4307
      data_type: uint16
    write:
      type: holding
      address: 4307
      data_type: uint16

  - platform: number
    key: tou_mode_reserved_soc
    name: "TOU Mode Reserved SOC (Holding 4545, uint16)"
    unit: "%"
    minimum: 10
    maximum: 100
    read:
      type: holding
      address: 4545
      data_type: uint16
    write:
      type: holding
      address: 4545
      data_type: uint16

  # ------------------------------------------------------------
  # [System Parameters]
  # ------------------------------------------------------------

  - platform: select
    key: work_status
    name: "Work Status (Input 0, uint16)"
    options:
      0: "PowerInit"
      1: "StdbyMode"
      2: "GridOnTest"
      3: "GridOnMode"
      4: "FaultMode"
      5: "GridOffMode"
      6: "ByPassMode"
    read:
      type: input
      address: 0
      data_type: uint16

  - platform: sensor
    key: power_dsp_fm_version
    name: "Power DSP FM Version (Input 1, uint16)"
    description: "Power DSP firmware version"
    read:
      type: input
      address: 1
      data_type: uint16

  - platform: sensor
    key: sw_fault
    name: "SW Fault (Input 19, uint32)"
    description: "Software fault code"
    read:
      type: input
      address: 19
      data_type: uint32

  - platform: sensor
    key: hw_fault
    name: "HW Fault (Input 21, uint32)"
    description: "Hardware fault code"
    read:
      type: input
      address: 21
      data_type: uint32

  - platform: sensor
    key: pv_total_power
    name: "PV Total Power (Input 26, uint16)"
    unit: "W"
    description: "PV total power"
    read:
      type: input
      address: 26
      data_type: uint16

  - platform: sensor
    key: pv1_voltage
    name: "PV1_Voltage (Input 27, uint16)"
    unit: "V"
    description: "PV1 voltage"
    read:
      type: input
      address: 27
      data_type: uint16
      scale: 0.1

  - platform: sensor
    key: pv1_current
    name: "PV1_Current (Input 28, int16)"
    unit: "A"
    description: "PV1 current"
    read:
      type: input
      address: 28
      data_type: int16
      scale: 0.01

  - platform: sensor
    key: pv1_power
    name: "PV1_Power (Input 29, uint16)"
    unit: "W"
    description: "PV1 power"
    read:
      type: input
      address: 29
      data_type: uint16

  - platform: sensor
    key: pv2_voltage
    name: "PV2_Voltage (Input 30, uint16)"
    unit: "V"
    description: "PV2 voltage"
    read:
      type: input
      address: 30
      data_type: uint16
      scale: 0.1

  - platform: sensor
    key: pv2_current
    name: "PV2_Current (Input 31, int16)"
    unit: "A"
    description: "PV2 current"
    read:
      type: input
      address: 31
      data_type: int16
      scale: 0.01

  - platform: sensor
    key: pv2_power
    name: "PV2_Power (Input 32, uint16)"
    unit: "W"
    description: "PV2 power"
    read:
      type: input
      address: 32
      data_type: uint16

  - platform: sensor
    key: pv3_voltage
    name: "PV3_Voltage (Input 33, uint16)"
    unit: "V"
    description: "PV3 voltage"
    read:
      type: input
      address: 33
      data_type: uint16
      scale: 0.1

  - platform: sensor
    key: pv3_current
    name: "PV3_Current (Input 34, int16)"
    unit: "A"
    description: "PV3 current"
    read:
      type: input
      address: 34
      data_type: int16
      scale: 0.01

  - platform: sensor
    key: pv3_power
    name: "PV3_Power (Input 35, uint16)"
    unit: "W"
    description: "PV3 power"
    read:
      type: input
      address: 35
      data_type: uint16

  - platform: sensor
    key: pv4_voltage
    name: "PV4_Voltage (Input 36, uint16)"
    unit: "V"
    description: "PV4 voltage"
    read:
      type: input
      address: 36
      data_type: uint16
      scale: 0.1

  - platform: sensor
    key: pv4_current
    name: "PV4_Current (Input 37, int16)"
    unit: "A"
    description: "PV4 current"
    read:
      type: input
      address: 37
      data_type: int16
      scale: 0.01

  - platform: sensor
    key: pv4_power
    name: "PV4_Power (Input 38, uint16)"
    unit: "W"
    description: "PV4 power"
    read:
      type: input
      address: 38
      data_type: uint16

  - platform: sensor
    key: bat_total_power
    name: "Bat Total Power (Input 45, int16)"
    unit: "W"
    description: "Battery total power"
    read:
      type: input
      address: 45
      data_type: int16

  - platform: sensor
    key: bat1_voltage
    name: "Bat1 Voltage (Input 46, uint16)"
    unit: "V"
    description: "Battery voltage"
    read:
      type: input
      address: 46
      data_type: uint16
      scale: 0.1

  - platform: sensor
    key: bat1_current_g3
    name: "Bat1 Current (G3) (Input 48, int32)"
    unit: "A"
    description: "The current expansion bit fits the G3 model"
    read:
      type: input
      address: 48
      data_type: int32
      scale: 0.01

  - platform: sensor
    key: bat1_power_g3
    name: "Bat1 Power (G3) (Input 50, int32)"
    unit: "W"
    description: "The current expansion bit fits the G3 model"
    read:
      type: input
      address: 50
      data_type: int32

  - platform: sensor
    key: positive_bus_voltage
    name: "Positive Bus Voltage (Input 58, uint16)"
    unit: "V"
    read:
      type: input
      address: 58
      data_type: uint16
      scale: 0.1

  - platform: sensor
    key: negative_bus_voltage
    name: "Negative Bus Voltage (Input 59, uint16)"
    unit: "V"
    read:
      type: input
      address: 59
      data_type: uint16
      scale: 0.1

  - platform: sensor
    key: bus_voltage
    name: "Bus Voltage (Input 60, uint16)"
    unit: "V"
    description: "DC bus voltage"
    read:
      type: input
      address: 60
      data_type: uint16
      scale: 0.1
